# DSA Parsing Project

Цей проект призначений для автоматичного завантаження, розпакування та обробки архівів з даними, що надаються сайтом [dsa.court.gov.ua](https://dsa.court.gov.ua). Основна мета — вилучення даних з CSV-файлів, що містяться в архівах, та їх збереження в базі даних MS SQL.

---

## Основні компоненти

### 1. **Модуль `scrap.py`**
- Основний модуль, який керує процесом завантаження, розпакування та обробки архівів.
- Використовує багатопотоковість (`ThreadPoolExecutor`) для завантаження архівів і мультипроцесинг (`ProcessPoolExecutor`) для розпакування та обробки даних.

### 2. **Модуль `csv_proccesing.py`**
- Відповідає за обробку CSV-файлів і передачу даних в чергу для запису в базу даних.

### 3. **Модуль `model.py`**
- Визначає структуру бази даних з використанням SQLAlchemy.
- Містить модель `Case`, що представляє записи з CSV-файлів.

---

## Логіка роботи

### 1. **Отримання списку архівів**
Функція `get_archives`:
- Відправляє HTTP-запити на сайт [dsa.court.gov.ua](https://dsa.court.gov.ua) для отримання списку архівів.
- Витягує посилання на архіви та їх дати з HTML-сторінок.
- Повертає список пар `(url, date)`.

### 2. **Завантаження архівів**
Функція `download_archive`:
- Має перевірку черги, та зупиняє завантаження, якщо черга повна.
- Завантажує архіви за вказаними URL.
- Зберігає архіви в тимчасовій директорії `zip_dir`.

### 3. **Розпакування архівів**
Функція `extract_archive`:
- Розпаковує завантажені архіви в піддиректорії тимчасової директорії.
- Передає розпаковані CSV-файли на обробку.

### 4. **Обробка CSV-файлів**
Функція `csv_proccesing`:
- Читає CSV-файли з розпакованих архівів.
- Перетворює дані у формат, придатний для збереження в базі даних.
- Відправляє дані в чергу для подальшого запису.

### 5. **Запис даних в базу**
Функція `writer_task`:
- Читає дані з черги.
- Зберігає дані в базу даних SQLite з використанням SQLAlchemy.
- Видаляє дублікати записів після завершення обробки.

### 6. **Отримання справ з бази даних**
Функція `get_cases`:
- Ця функція завантажує список номерів справ із CSV-файлу.
- Шукає відповідні записи в базі даних через SQLAlchemy.
- Знайдені дані зберігаються в новому файлі output.csv.

---

## Встановлення та запуск

### 1. Встановлення залежностей
```bash
pip install -r requirements.txt
```

### 2. Запуск для завантаження данних в базу
```bash
python main.py
```

### 3. Запуск для отримання даних з бази
- Попередньо додати справи в файл `cases.csv`
```bash
python get_cases_from_csv.py
```
